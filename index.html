import React, { useState, useMemo, useEffect } from 'react';
import { 
    LayoutDashboard, DollarSign, Package, Users, ShoppingCart, BarChart2, 
    AlertCircle, ArrowUpRight, ArrowDownRight, Plus, Search, Edit, Trash2, X, MoreVertical, MinusCircle, PlusCircle, CreditCard
} from 'lucide-react';

// --- MOCK DATA ---
const mockData = {
  stats: [
    { title: "Today's Revenue", value: "$1,250.75", icon: DollarSign, trend: "+12.5%", trendDirection: "up", color: "text-green-500", bgColor: "bg-green-50" },
    { title: "Today's Sales", value: "82", icon: ShoppingCart, trend: "+5.1%", trendDirection: "up", color: "text-blue-500", bgColor: "bg-blue-50" },
    { title: "Total Inventory", value: "1,482 units", icon: Package, trend: "72 SKU", trendDirection: "neutral", color: "text-indigo-500", bgColor: "bg-indigo-50" },
    { title: "New Customers", value: "15", icon: Users, trend: "-2.8%", trendDirection: "down", color: "text-orange-500", bgColor: "bg-orange-50" },
  ],
  inventory: [
    { id: 1, name: "iPhone 15 Pro", sku: "PH-APL-15P-256", category: "Phones", stock: 25, price: 999.00, imageUrl: `https://placehold.co/40x40/E0E7FF/4F46E5?text=i15P` },
    { id: 2, name: "Samsung Galaxy S24", sku: "PH-SAM-S24-128", category: "Phones", stock: 30, price: 799.00, imageUrl: `https://placehold.co/40x40/DBEAFE/1D4ED8?text=S24` },
    { id: 3, name: "Anker Power Bank", sku: "AC-ANK-PB-10K", category: "Accessories", stock: 75, price: 39.99, imageUrl: `https://placehold.co/40x40/FEE2E2/B91C1C?text=PB` },
    { id: 4, name: "JBL Tune 510BT", sku: "AU-JBL-T510-BLK", category: "Audio", stock: 40, price: 49.95, imageUrl: `https://placehold.co/40x40/D1FAE5/047857?text=JBL` },
    { id: 5, name: "Spigen Tough Armor Case", sku: "AC-SPG-TA-S24", category: "Cases", stock: 120, price: 24.99, imageUrl: `https://placehold.co/40x40/E5E7EB/4B5563?text=Case` },
    { id: 6, name: "Google Pixel 8", sku: "PH-GOO-P8-128", category: "Phones", stock: 15, price: 699.00, imageUrl: `https://placehold.co/40x40/FEF3C7/B45309?text=P8` },
    { id: 7, name: "USB-C to Lightning Cable", sku: "AC-CBL-CL-1M", category: "Accessories", stock: 250, price: 19.00, imageUrl: `https://placehold.co/40x40/E0E7FF/4F46E5?text=CBL` },
    { id: 8, name: "Sony WH-1000XM5", sku: "AU-SNY-XM5-SLV", category: "Audio", stock: 22, price: 399.99, imageUrl: `https://placehold.co/40x40/F3F4F6/111827?text=XM5` },
  ],
  salesHistory: [
    { id: "ORD-004", customerName: "Emily White", totalAmount: 89.99, status: "Completed", date: "2024-08-20", items: [{ id: 5, name: "Spigen Tough Armor Case", quantity: 1, price: 24.99 }, { id: 3, name: "Anker Power Bank", quantity: 1, price: 39.99 }] },
    { id: "ORD-003", customerName: "Mike Johnson", totalAmount: 320.00, status: "Completed", date: "2024-08-20", items: [{ id: 2, name: "Samsung Galaxy S24", quantity: 1, price: 799.00 }] },
    { id: "ORD-002", customerName: "Jane Smith", totalAmount: 45.50, status: "Refunded", date: "2024-08-19", items: [{ id: 4, name: "JBL Tune 510BT", quantity: 1, price: 49.95 }] },
    { id: "ORD-001", customerName: "John Doe", totalAmount: 150.00, status: "Completed", date: "2024-08-19", items: [{ id: 7, name: "USB-C to Lightning Cable", quantity: 2, price: 19.00 }] },
  ],
};

// --- HELPER & GENERIC COMPONENTS ---

const StatCard = ({ item }) => {
  const TrendIcon = item.trendDirection === 'up' ? ArrowUpRight : ArrowDownRight;
  return (
    <div className="bg-white p-4 sm:p-6 rounded-2xl shadow-sm hover:shadow-lg transition-shadow duration-300 flex flex-col justify-between">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-sm sm:text-base font-medium text-gray-500">{item.title}</h3>
        <div className={`p-2 rounded-lg ${item.bgColor}`}><item.icon className={`h-5 w-5 ${item.color}`} /></div>
      </div>
      <div>
        <p className="text-2xl sm:text-3xl font-bold text-gray-800">{item.value}</p>
        <div className="flex items-center text-xs sm:text-sm mt-1">
          {item.trendDirection !== 'neutral' && <TrendIcon className={`h-4 w-4 mr-1 ${item.trendDirection === 'up' ? 'text-green-600' : 'text-red-600'}`} />}
          <span className={`${item.trendDirection === 'up' ? 'text-green-600' : item.trendDirection === 'down' ? 'text-red-600' : 'text-gray-500'}`}>{item.trend}</span>
          {item.trendDirection !== 'neutral' && <span className="text-gray-500 ml-1">vs yesterday</span>}
        </div>
      </div>
    </div>
  );
};

const AddItemModal = ({ isOpen, onClose, onSave, itemToEdit }) => {
  const [item, setItem] = useState(null);

  useEffect(() => {
    if (itemToEdit) {
      setItem(itemToEdit);
    } else {
      setItem({ id: null, name: '', sku: '', category: '', stock: '', price: '', imageUrl: `https://placehold.co/40x40/E5E7EB/4B5563?text=New` });
    }
  }, [itemToEdit, isOpen]);

  if (!isOpen || !item) return null;

  const handleChange = (e) => {
    const { name, value } = e.target;
    setItem(prev => ({ ...prev, [name]: value }));
  };

  const handleSave = (e) => {
    e.preventDefault();
    onSave(item);
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4">
      <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md">
        <div className="flex justify-between items-center p-4 sm:p-6 border-b border-gray-200">
          <h3 className="text-lg font-semibold text-gray-800">{itemToEdit ? 'Edit Item' : 'Add New Item'}</h3>
          <button onClick={onClose} className="text-gray-400 hover:text-gray-600"><X className="h-6 w-6" /></button>
        </div>
        <form onSubmit={handleSave}>
          <div className="p-4 sm:p-6 space-y-4">
            <div><label htmlFor="name" className="text-sm font-medium text-gray-700 block mb-1">Product Name</label><input type="text" name="name" id="name" value={item.name} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required /></div>
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div><label htmlFor="sku" className="text-sm font-medium text-gray-700 block mb-1">SKU</label><input type="text" name="sku" id="sku" value={item.sku} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required /></div>
              <div><label htmlFor="category" className="text-sm font-medium text-gray-700 block mb-1">Category</label><input type="text" name="category" id="category" value={item.category} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required /></div>
            </div>
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div><label htmlFor="stock" className="text-sm font-medium text-gray-700 block mb-1">Stock</label><input type="number" name="stock" id="stock" value={item.stock} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required /></div>
              <div><label htmlFor="price" className="text-sm font-medium text-gray-700 block mb-1">Price ($)</label><input type="number" step="0.01" name="price" id="price" value={item.price} onChange={handleChange} className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500" required /></div>
            </div>
          </div>
          <div className="p-4 sm:p-6 bg-gray-50 rounded-b-2xl flex justify-end space-x-3"><button type="button" onClick={onClose} className="px-4 py-2 bg-white border border-gray-300 rounded-lg text-sm font-semibold text-gray-700 hover:bg-gray-50">Cancel</button><button type="submit" className="px-4 py-2 bg-indigo-600 border border-transparent rounded-lg text-sm font-semibold text-white hover:bg-indigo-700">Save Item</button></div>
        </form>
      </div>
    </div>
  );
};

const NewSaleModal = ({ isOpen, onClose, inventory, onCompleteSale }) => {
    const [searchTerm, setSearchTerm] = useState('');
    const [cart, setCart] = useState([]);
  
    const filteredInventory = useMemo(() =>
      inventory.filter(item =>
        item.name.toLowerCase().includes(searchTerm.toLowerCase()) && item.stock > 0
      ), [inventory, searchTerm]);
  
    const addToCart = (product) => {
      setCart(currentCart => {
        const existingItem = currentCart.find(item => item.id === product.id);
        if (existingItem) {
          if (existingItem.quantity < product.stock) {
            return currentCart.map(item =>
              item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
            );
          }
          return currentCart; // Do not add more than available in stock
        }
        return [...currentCart, { ...product, quantity: 1 }];
      });
    };
  
    const updateQuantity = (productId, newQuantity) => {
        const productInInventory = inventory.find(p => p.id === productId);
        if (newQuantity <= 0) {
            setCart(cart.filter(item => item.id !== productId));
        } else if (productInInventory && newQuantity <= productInInventory.stock) {
            setCart(cart.map(item => item.id === productId ? { ...item, quantity: newQuantity } : item));
        }
    };
  
    const totalAmount = useMemo(() =>
      cart.reduce((sum, item) => sum + item.price * item.quantity, 0),
      [cart]
    );

    const handleCompleteSale = () => {
        onCompleteSale(cart, totalAmount);
        setCart([]);
        onClose();
    };
  
    if (!isOpen) return null;
  
    return (
      <div className="fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center">
        <div className="bg-gray-50 w-full h-full md:max-w-4xl md:h-auto md:max-h-[90vh] md:rounded-2xl flex flex-col">
          <header className="flex justify-between items-center p-4 border-b bg-white md:rounded-t-2xl">
            <h2 className="text-xl font-bold text-gray-800">New Sale</h2>
            <button onClick={onClose} className="text-gray-500 hover:text-gray-800"><X /></button>
          </header>
          <div className="flex-grow flex flex-col md:flex-row overflow-hidden">
            {/* Product List */}
            <div className="w-full md:w-1/2 p-4 flex flex-col">
              <div className="relative mb-4">
                <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" />
                <input type="text" placeholder="Search products..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full pl-10 pr-4 py-2 border rounded-lg"/>
              </div>
              <div className="flex-grow overflow-y-auto space-y-2 pr-2">
                {filteredInventory.map(product => (
                  <div key={product.id} className="flex items-center bg-white p-2 rounded-lg shadow-sm">
                    <img src={product.imageUrl} alt={product.name} className="w-12 h-12 rounded-md mr-3" />
                    <div className="flex-grow">
                      <p className="font-semibold text-gray-800 text-sm">{product.name}</p>
                      <p className="text-xs text-gray-500">In Stock: {product.stock}</p>
                    </div>
                    <p className="font-bold text-gray-800 mr-3">${product.price.toFixed(2)}</p>
                    <button onClick={() => addToCart(product)} className="bg-indigo-100 text-indigo-600 hover:bg-indigo-200 p-2 rounded-full"><Plus className="h-5 w-5" /></button>
                  </div>
                ))}
              </div>
            </div>
            {/* Cart */}
            <div className="w-full md:w-1/2 bg-white p-4 flex flex-col border-t md:border-t-0 md:border-l">
              <h3 className="text-lg font-semibold mb-4">Current Order</h3>
              <div className="flex-grow overflow-y-auto">
                {cart.length === 0 ? (
                  <p className="text-gray-500 text-center mt-10">Your cart is empty.</p>
                ) : (
                  <ul className="space-y-3">
                    {cart.map(item => (
                      <li key={item.id} className="flex items-center">
                        <img src={item.imageUrl} alt={item.name} className="w-10 h-10 rounded-md mr-3" />
                        <div className="flex-grow">
                          <p className="font-semibold text-sm">{item.name}</p>
                          <p className="text-xs text-gray-500">${item.price.toFixed(2)}</p>
                        </div>
                        <div className="flex items-center">
                          <button onClick={() => updateQuantity(item.id, item.quantity - 1)}><MinusCircle className="h-5 w-5 text-gray-400 hover:text-red-500" /></button>
                          <span className="w-8 text-center font-semibold">{item.quantity}</span>
                          <button onClick={() => updateQuantity(item.id, item.quantity + 1)}><PlusCircle className="h-5 w-5 text-gray-400 hover:text-green-500" /></button>
                        </div>
                        <p className="w-20 text-right font-bold text-sm">${(item.price * item.quantity).toFixed(2)}</p>
                      </li>
                    ))}
                  </ul>
                )}
              </div>
              <div className="border-t pt-4 mt-4">
                <div className="flex justify-between text-lg font-bold">
                  <span>Total</span>
                  <span>${totalAmount.toFixed(2)}</span>
                </div>
                <button onClick={handleCompleteSale} disabled={cart.length === 0} className="w-full mt-4 bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center justify-center">
                  <CreditCard className="mr-2" /> Complete Sale
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  };

// --- PAGE COMPONENTS ---

const Dashboard = () => (
  <div className="p-4 sm:p-6 bg-gray-50 min-h-screen">
    <header className="mb-6"><h1 className="text-2xl sm:text-3xl font-bold text-gray-900">Dashboard</h1><p className="text-gray-500 mt-1">Welcome back! Here's a snapshot of your shop's performance.</p></header>
    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6">{mockData.stats.map((item, index) => <StatCard key={index} item={item} />)}</div>
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
      <div className="lg:col-span-2 bg-white p-4 sm:p-6 rounded-2xl shadow-sm hover:shadow-lg transition-shadow duration-300">
        <h3 className="text-lg font-semibold text-gray-800 mb-4">Recent Sales</h3>
        <div className="overflow-x-auto"><table className="w-full text-sm text-left text-gray-600"><thead className="text-xs text-gray-700 uppercase bg-gray-50 rounded-t-lg"><tr><th scope="col" className="px-4 py-3">Order ID</th><th scope="col" className="px-4 py-3">Customer</th><th scope="col" className="px-4 py-3">Amount</th><th scope="col" className="px-4 py-3">Time</th></tr></thead><tbody>{mockData.salesHistory.slice(0, 4).map((sale) => (<tr key={sale.id} className="bg-white border-b hover:bg-gray-50"><td className="px-4 py-3 font-medium text-gray-900">{sale.id}</td><td className="px-4 py-3">{sale.customerName}</td><td className="px-4 py-3 font-semibold">${sale.totalAmount.toFixed(2)}</td><td className="px-4 py-3 text-gray-500">{sale.date}</td></tr>))}</tbody></table></div>
      </div>
      <div className="bg-white p-4 sm:p-6 rounded-2xl shadow-sm hover:shadow-lg transition-shadow duration-300">
        <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center"><AlertCircle className="h-5 w-5 mr-2 text-red-500" />Low Stock Items</h3>
        <ul className="space-y-4">{mockData.inventory.filter(i => i.stock <= 5).slice(0, 3).map((item) => (<li key={item.sku} className="flex items-center justify-between"><div><p className="font-medium text-gray-800">{item.name}</p><p className="text-xs text-gray-500">SKU: {item.sku}</p></div><span className="bg-red-100 text-red-800 text-sm font-bold px-3 py-1 rounded-full">{item.stock} left</span></li>))}</ul>
        <button className="w-full mt-6 bg-indigo-600 text-white font-semibold py-2 rounded-lg hover:bg-indigo-700 transition-colors duration-300">Create Purchase Order</button>
      </div>
    </div>
  </div>
);

const InventoryPage = ({ inventory, handleAddItem, handleUpdateItem, handleDeleteItem }) => {
  const [searchTerm, setSearchTerm] = useState('');
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [itemToEdit, setItemToEdit] = useState(null);
  const filteredInventory = useMemo(() => inventory.filter(item => item.name.toLowerCase().includes(searchTerm.toLowerCase()) || item.sku.toLowerCase().includes(searchTerm.toLowerCase()) || item.category.toLowerCase().includes(searchTerm.toLowerCase())), [inventory, searchTerm]);
  const openModalForEdit = (item) => { setItemToEdit(item); setIsModalOpen(true); };
  const openModalForAdd = () => { setItemToEdit(null); setIsModalOpen(true); };
  const onSave = (item) => { if(item.id) { handleUpdateItem(item); } else { handleAddItem(item); } setIsModalOpen(false); };
  return (<div className="p-4 sm:p-6 bg-gray-50 min-h-screen"><AddItemModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} onSave={onSave} itemToEdit={itemToEdit} /><header className="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between"><div><h1 className="text-2xl sm:text-3xl font-bold text-gray-900">Inventory</h1><p className="text-gray-500 mt-1">Manage your products and stock levels.</p></div><button onClick={openModalForAdd} className="mt-4 sm:mt-0 flex items-center justify-center bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300 shadow-sm"><Plus className="h-5 w-5 mr-2" />Add New Item</button></header><div className="bg-white p-4 sm:p-6 rounded-2xl shadow-sm"><div className="mb-4"><div className="relative"><Search className="absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400" /><input type="text" placeholder="Search by name, SKU, or category..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"/></div></div><div className="overflow-x-auto"><table className="w-full text-sm text-left text-gray-600"><thead className="text-xs text-gray-700 uppercase bg-gray-50"><tr><th scope="col" className="px-6 py-3">Product</th><th scope="col" className="px-6 py-3">SKU</th><th scope="col" className="px-6 py-3">Category</th><th scope="col" className="px-6 py-3">Stock</th><th scope="col" className="px-6 py-3">Price</th><th scope="col" className="px-6 py-3"><span className="sr-only">Actions</span></th></tr></thead><tbody>{filteredInventory.map((item) => (<tr key={item.id} className="bg-white border-b hover:bg-gray-50"><th scope="row" className="px-6 py-4 font-medium text-gray-900 whitespace-nowrap flex items-center"><img src={item.imageUrl} alt={item.name} className="w-10 h-10 rounded-lg mr-4" />{item.name}</th><td className="px-6 py-4">{item.sku}</td><td className="px-6 py-4">{item.category}</td><td className="px-6 py-4"><span className={`px-2 py-1 rounded-full text-xs font-semibold ${item.stock > 10 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>{item.stock}</span></td><td className="px-6 py-4">${item.price.toFixed(2)}</td><td className="px-6 py-4 text-right"><button onClick={() => openModalForEdit(item)} className="p-2 text-gray-500 hover:text-indigo-600"><Edit className="h-4 w-4" /></button><button onClick={() => handleDeleteItem(item.id)} className="p-2 text-gray-500 hover:text-red-600"><Trash2 className="h-4 w-4" /></button></td></tr>))}</tbody></table></div>{filteredInventory.length === 0 && <p className="text-center text-gray-500 py-8">No items found.</p>}</div></div>);
};

const SalesPage = ({ salesHistory, inventory, handleNewSale }) => {
    const [isModalOpen, setIsModalOpen] = useState(false);
    const getStatusColor = (status) => {
        switch (status) {
            case 'Completed': return 'bg-green-100 text-green-800';
            case 'Pending': return 'bg-yellow-100 text-yellow-800';
            case 'Refunded': return 'bg-red-100 text-red-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    };

    return (
        <div className="p-4 sm:p-6 bg-gray-50 min-h-screen">
            <NewSaleModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} inventory={inventory} onCompleteSale={handleNewSale} />
            <header className="mb-6 flex flex-col sm:flex-row sm:items-center sm:justify-between">
                <div>
                    <h1 className="text-2xl sm:text-3xl font-bold text-gray-900">Sales</h1>
                    <p className="text-gray-500 mt-1">Review your sales history and create new orders.</p>
                </div>
                <button onClick={() => setIsModalOpen(true)} className="mt-4 sm:mt-0 flex items-center justify-center bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition-colors duration-300 shadow-sm">
                    <Plus className="h-5 w-5 mr-2" />
                    New Sale
                </button>
            </header>
            <div className="bg-white p-4 sm:p-6 rounded-2xl shadow-sm">
                <h3 className="text-lg font-semibold text-gray-800 mb-4">Sales History</h3>
                <div className="overflow-x-auto">
                    <table className="w-full text-sm text-left text-gray-600">
                        <thead className="text-xs text-gray-700 uppercase bg-gray-50">
                            <tr>
                                <th scope="col" className="px-6 py-3">Order ID</th>
                                <th scope="col" className="px-6 py-3">Customer</th>
                                <th scope="col" className="px-6 py-3">Date</th>
                                <th scope="col" className="px-6 py-3">Status</th>
                                <th scope="col" className="px-6 py-3">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            {salesHistory.map((sale) => (
                                <tr key={sale.id} className="bg-white border-b hover:bg-gray-50">
                                    <td className="px-6 py-4 font-medium text-gray-900">{sale.id}</td>
                                    <td className="px-6 py-4">{sale.customerName}</td>
                                    <td className="px-6 py-4">{sale.date}</td>
                                    <td className="px-6 py-4">
                                        <span className={`px-2 py-1 rounded-full text-xs font-semibold ${getStatusColor(sale.status)}`}>
                                            {sale.status}
                                        </span>
                                    </td>
                                    <td className="px-6 py-4 font-semibold">${sale.totalAmount.toFixed(2)}</td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
};

const CustomersPage = () => <div className="p-6 text-center text-2xl font-bold text-gray-700">Customers Page</div>;
const ReportsPage = () => <div className="p-6 text-center text-2xl font-bold text-gray-700">Reports Page</div>;

// --- NAVIGATION COMPONENTS ---

const BottomNav = ({ activeTab, setActiveTab }) => {
  const navItems = [{ id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard }, { id: 'sales', label: 'Sales', icon: ShoppingCart }, { id: 'inventory', label: 'Inventory', icon: Package }, { id: 'customers', label: 'Customers', icon: Users }, { id: 'reports', label: 'Reports', icon: BarChart2 }];
  return (<div className="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] md:hidden z-10"><div className="flex justify-around">{navItems.map((item) => (<button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex flex-col items-center justify-center w-full py-2 transition-colors duration-300 ${activeTab === item.id ? 'text-indigo-600' : 'text-gray-500 hover:text-indigo-500'}`}><item.icon className="h-6 w-6 mb-1" /><span className="text-xs font-medium">{item.label}</span></button>))}</div></div>);
};

const Sidebar = ({ activeTab, setActiveTab }) => {
  const navItems = [{ id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard }, { id: 'sales', label: 'Sales', icon: ShoppingCart }, { id: 'inventory', label: 'Inventory', icon: Package }, { id: 'customers', label: 'Customers', icon: Users }, { id: 'reports', label: 'Reports', icon: BarChart2 }];
  return (<aside className="hidden md:flex flex-col w-64 bg-white border-r border-gray-200"><div className="flex items-center justify-center h-20 border-b"><Package className="h-8 w-8 text-indigo-600" /><h1 className="ml-2 text-2xl font-bold text-gray-800">ShopSync</h1></div><nav className="flex-1 px-4 py-6">{navItems.map((item) => (<button key={item.id} onClick={() => setActiveTab(item.id)} className={`flex items-center w-full px-4 py-3 mb-2 rounded-lg transition-colors duration-200 ${activeTab === item.id ? 'bg-indigo-600 text-white shadow-md' : 'text-gray-600 hover:bg-gray-100'}`}><item.icon className="h-5 w-5" /><span className="ml-4 font-semibold">{item.label}</span></button>))}</nav></aside>);
};

// --- MAIN APP COMPONENT ---

export default function App() {
  const [activeTab, setActiveTab] = useState('sales');
  const [inventory, setInventory] = useState(mockData.inventory);
  const [salesHistory, setSalesHistory] = useState(mockData.salesHistory);

  const handleAddItem = (item) => {
    const newItem = { ...item, id: Date.now() };
    setInventory(prev => [newItem, ...prev]);
  };

  const handleUpdateItem = (updatedItem) => {
    setInventory(prev => prev.map(item => item.id === updatedItem.id ? updatedItem : item));
  };

  const handleDeleteItem = (itemId) => {
    setInventory(prev => prev.filter(item => item.id !== itemId));
  };

  const handleNewSale = (cartItems, totalAmount) => {
    // 1. Create the new sale record
    const newSale = {
        id: `ORD-${String(salesHistory.length + 5).padStart(3, '0')}`,
        customerName: "Walk-in Customer", // Placeholder
        totalAmount,
        status: "Completed",
        date: new Date().toISOString().split('T')[0], // YYYY-MM-DD format
        items: cartItems.map(item => ({ id: item.id, name: item.name, quantity: item.quantity, price: item.price }))
    };
    setSalesHistory(prev => [newSale, ...prev]);

    // 2. Update inventory stock
    setInventory(currentInventory => {
        const updatedInventory = [...currentInventory];
        cartItems.forEach(cartItem => {
            const itemIndex = updatedInventory.findIndex(invItem => invItem.id === cartItem.id);
            if(itemIndex !== -1) {
                updatedInventory[itemIndex].stock -= cartItem.quantity;
            }
        });
        return updatedInventory;
    });
  };

  const renderContent = () => {
    switch (activeTab) {
      case 'dashboard': return <Dashboard />;
      case 'inventory': return <InventoryPage inventory={inventory} handleAddItem={handleAddItem} handleUpdateItem={handleUpdateItem} handleDeleteItem={handleDeleteItem} />;
      case 'sales': return <SalesPage salesHistory={salesHistory} inventory={inventory} handleNewSale={handleNewSale} />;
      case 'customers': return <CustomersPage />;
      case 'reports': return <ReportsPage />;
      default: return <Dashboard />;
    }
  };

  return (
    <div className="font-sans bg-gray-50 flex">
      <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} />
      <main className="flex-1 pb-16 md:pb-0">
        {renderContent()}
      </main>
      <BottomNav activeTab={activeTab} setActiveTab={setActiveTab} />
    </div>
  );
}
